<% dps_to_show = @cardset.details_pages.reject(&:new_record?).sort_by { |dp| dp.order || 0 } # &:order %>
<% dps_to_show.each_with_index do |p, index| %>
  <%= link_to_unless_current p.title, url_for([@cardset, p]) do %>
    <% # This entire block is only evaluated for the current details page (if any) %>
    <% current_order = p.order %>
    <% if permission_to?(:admin, @cardset) && current_order > 0 %>
      <%= form_for [@cardset, p], :remote => true, :dataType => 'script' do |f| %>
        <%= f.hidden_field :order, :value => p.order - 1 %>
        <%= image_submit_tag "moveleft.png", :alt => "Move this details page left",
                                           :title => "Move this details page left",
                                           :class => "image_submit" %>
      <% end %>
    <% end %>
    <%= p.title %>
    <% if permission_to?(:admin, @cardset) && current_order < dps_to_show.length-1 %>
      <%= form_for [@cardset, p], :remote => true, :dataType => 'script' do |f| %>
        <%= f.hidden_field :order, :value => p.order + 1 %>
        <%= image_submit_tag "moveright.png", :alt => "Move this details page right",
                                           :title => "Move this details page right",
                                           :class => "image_submit" %>
      <% end %>
    <% end %>
  <% end %>
  <% if index < dps_to_show.length-1 %>
    |
  <% end %>
<% end %>
