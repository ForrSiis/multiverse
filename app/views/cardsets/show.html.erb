<h1>
  <%= @title = @cardset.name %>
</h1>

<p>
  <%= @cardset.description %>
</p>

<% if signed_in_as_admin?(@cardset) %>
  <p><!-- style="display: inline-block; margin-left: 200px;"> -->
    Admin actions:
    <%= link_to "Edit description", edit_cardset_path(@cardset) %>;
    <%= link_to "New card", new_card_path(:cardset_id => @cardset.id) %>;
    <%= link_to "Import data", import_cardset_path(@cardset) %>;
    <%= link_to "Delete entire cardset", @cardset,
      :confirm => "Really delete this whole cardset and all cards in it?",
      :method => :delete %>
  </p>
<% end %>

<p>
  <b>Creator:</b>
  <% @owner = User.find_by_id(@cardset.user_id) %>
  <%= link_to @owner.name, @owner %>
</p>

<% @allmycards = @cardset.cards %>
<% @myactivecards = @allmycards.map{ |card| card.active? } %>
<p><%= @allmycards.length %> cards in Multiverse
  <% if ! @myactivecards.all? %>
    (<%= @myactivecards.length %> active)
  <% end %>
</p>

<%= render 'setviews' %>

<!-- something to do with highlighted cards
  <p>The set creator would like to draw your attention to these comments:
  all highlighted comments.do
    On <###%= link_to @comment.card %###>: <###%= @comment.comment %###>

  -->

<% recentcards = Card.order("updated_at DESC").find_all_by_cardset_id(@cardset.id, :limit => 5) %>

<p>
  <% if !recentcards.empty? %>
    Recently updated cards:
    <table>
     <tr>
      <% recentcards.each do |@card| %>
       <td>
        <%= render :partial => 'shared/prettycard', :locals => { :link => true } %>
        <%= link_to "Comments (#{@card.comments.count})", @card %>
        <% if signed_in_as_admin?(@cardset) %>
         | <%= link_to "Edit", edit_card_path(@card) %>
        <% end %>
       </td>
      <% end %>
     </tr>
    </table>
  <% else %>
    <% if signed_in_as_admin?(@cardset) %>
      There are no cards in this cardset. Why not <%= link_to "add a card", cardset_new_card_path %> or <%= link_to "import some", cardset_import_path %>?
    <% else %>
      The cardset owner, <%= link_to @owner.name, @owner %>, has not added any cards to this cardset yet.
    <% end %>
  <% end %>
</p>

<div>
  <% recentcomments = Comment.find(:all, :include => :card,
       :conditions => ["cards.cardset_id = ?", @cardset.id],
       :order => "comments.updated_at DESC") %>
  <% if recentcomments.empty? %>
    There are no comments on any cards in the cardset.
    <% if !recentcards.empty? %>
      <% if signed_in_as_admin?(@cardset) %>
        Why not ask for some feedback on a few cards from visitors?
      <% else %>
        Why not browse the cards and add your thoughts?
      <% end %>
    <% end %>
  <% else %>
    Recent comments:
    <ul class="commentlist">
      <% recentcomments.take(3).each do |comment| %>
        <% if comment.nil? %>
          <% if Rails.env.development? %>
            NIL
          <% end %>
        <% else %>
          <% @card = comment.card %>
          <li>On <%= link_to @card.name, @card %>:
          <%= render :partial => 'shared/comment', :locals => { :comment => comment } %>
        <% end %>
      <% end %>
    </ul>
  <% end %>
</div>

<%= link_to 'See other cardsets', cardsets_path %>
