<% @title = @card.name %>
<% new_comment = @comment # store, because we'll be overwriting "@comment" to show previous comments %>

<%= javascript_include_tag "fabtabulous.js" %>

<table border="0"> <!-- grouping table -->
 <tr>
  <td class="cardcell"> <!-- card -->
   <ul class="cardtabs" id="tabs">
    <% if !@card.image_url.blank? %>
      <li><a href="#cardimage">Image</a></li>
    <% end %>
    <li><a href="#mockup">Mockup</a></li>
    <li><a href="#plaincard">Plain</a></li>
   </ul>
   <% if signed_in_as_admin?(@cardset) %>
     <ul class="cardtabs">
      <li><%= link_to 'Edit', edit_card_path(@card) %></li>
     </ul>
   <% end %>

   <div class="onetab" id="cardimage"><a name="cardimage"></a>
     <img src="<%= @card.image_url %>">
   </div>
   <div class="onetab" id="plaincard"><a name="plaincard"></a>
     <%= render :partial => 'shared/plaincard' %>
   </div>
   <div class="onetab" id="mockup"><a name="mockup"></a>
     <%= render :partial => 'shared/prettycard', :locals => { :link => false } %>
   </div>
   <div class="card_controls_below">
     <% if signed_in_as_admin?(@card.cardset) %>
       <%= link_to 'Edit card', edit_card_path(@card) %>
       |
       <%= link_to 'Delete card', @card, :confirm => "Really DELETE #{@card.name}?", :method => :delete %>
     <% end %>
   </div>
  </td> <!-- end of card -->

  <td> <!-- controls, comments etc -->
     <% @cardset = Cardset.find(@card.cardset_id) %>
     <%= render 'cardsets/setviews' %>

     <% if @card.cardset.configuration.card_show_code %>
       <p><b>Code:</b> <%= @card.code %></p>
     <% end %>
     <% if @card.cardset.configuration.card_show_active %>
       <p><b>Active?:</b> <%= @card.active %></p>
     <% end %>
     <p>
       <b>Comments:</b>
       <div class="cardhistory">
       <ul>
         <% @card.comments.each do |@comment| %>
           <%= render :partial => 'shared/comment', :locals => { :buttons => true } %>
         <% end %>
       </ul>
       </div>
       <% if permission_to_comment(@card.cardset) %>
         <b>Add your comments:</b>
         <% @comment = new_comment # restore the value stored at the top %>
         <%= render 'shared/card_comment_form' %>
       <% else %>
         <%= @cardset.comment_permission_message %>
         <% if !signed_in? %>
           Would you like to <%= link_to "sign in", signin_path %>?
         <% end %>
       <% end %>
     </p>
  </td>
 </tr>
</table>
   <% case @card.cardset.configuration.frame
        when "image":      desired_tab = "cardimage"
        when "plain":      desired_tab = "plaincard"
        when "prettycard": desired_tab = "mockup"
      end
    %>
   <script type="text/javascript">
     if(String(document.location).split('#').length == 1) {
       // No anchor: choose one according to the configuration frame
       document.location += "#<%= desired_tab %>";
     }
     new Fabtabs('tabs');
   </script>
